# "Ride-Mates: A greener ride, a more social journey" üå±üöó

## POSTMAN: 

https://app.getpostman.com/join-team?invite_code=c4210592c1ac3ae458d8a11c06db9c3d&target_code=59618308a15fa54476049f484817c913 

## CS 2031 Desarrollo Basado en Plataformas üíª

## Project Members ü´Ç

| Name                           | GitHub User            | Email                                       |
|--------------------------------|------------------------|---------------------------------------------|
| Salvador Donayre Epifania      | [*OcZi*](**)             | [*salvador.donayre@utec.edu.pe*](mailto:**)  |
| Adrian Alejandro Montes Vargas | [AdrianMontes0512](**) | [*adrian.montes@utec.edu.pe*](mailto:**)    |
| Nayeli Fernanda Guzman Huayta  | [nayeli-guzman](**)          | [*nayeli.guzman@utec.edu.pe*](mailto:**) |

## √çndice üìë
- [Introducci√≥n](#introducci√≥n)
- [Identificaci√≥n del Problema o Necesidad](#identificaci√≥n-del-problema-o-necesidad)
- [Descripci√≥n de la Soluci√≥n](#descripci√≥n-de-la-soluci√≥n)
- [Modelo de Entidades](#modelo-de-entidades)
- [Testing y Manejo de Errores](#testing-y-manejo-de-errores)
- [Medidas de Seguridad Implementadas](#medidas-de-seguridad-implementadas)
- [Eventos y Asincron√≠a](#eventos-y-asincron√≠a)
- [GitHub](#github)
- [Conclusi√≥n](#conclusi√≥n)
- [Ap√©ndice](#ap√©ndice)

## Introducci√≥n üåü

### Contexto ‚ùì

El nombre "Ride Mates" proviene de la combinaci√≥n de las palabras "ride" (viaje) y "mates" (compa√±eros), reflejando la idea de compartir viajes con compa√±eros de la comunidad universitaria. La iniciativa busca abordar la creciente inseguridad en la zona, especialmente durante la noche, y promover un sentido de comunidad y colaboraci√≥n entre los miembros de la universidad.

### Objetivos del Proyecto üéØ

- **Desarrollar una aplicaci√≥n** que ofrezca un transporte seguro y eficiente para los estudiantes de UTEC, conectando a quienes necesitan transporte con aquellos que est√°n dispuestos a ofrecerlo.
- **Crear una aplicaci√≥n m√≥vil** con funciones clave como perfiles, geolocalizaci√≥n y gesti√≥n de reservas.
- **Implementar un sistema de verificaci√≥n** para asegurar la legitimidad de conductores y pasajeros.
- **Dise√±ar una interfaz de usuario intuitiva** para mejorar la experiencia del estudiante.
- **Establecer protocolos de seguridad** para proteger la informaci√≥n personal de los usuarios.

## Identificaci√≥n del Problema o Necesidad ü´°

La idea de "Ride Mates", una aplicaci√≥n de _carpooling_ para el entorno de UTEC, surge de la creciente inseguridad en la zona, especialmente durante la noche, donde se han ido reportando robos. Los estudiantes, al dirigirse a sus paraderos, est√°n expuestos a peligros. Ante esta situaci√≥n, "Ride Mates" ofrece una soluci√≥n de transporte segura. Adem√°s de abordar este problema principal, la aplicaci√≥n tiene el potencial de adaptarse a otros desaf√≠os relacionados.

## Descripci√≥n de la Soluci√≥n üí°

### Funcionalidades Implementadas üî©

1. **Registro y Autenticaci√≥n de Usuarios**:
    - Desarrollo de un sistema de autenticaci√≥n utilizando JWT, que permite a los usuarios registrarse e iniciar sesi√≥n de manera segura. El flujo es el siguiente:
    - `/auth/signup`: Permite al usuario registrarse por primera vez en la app, a partir de esto se le mandar√° un correo con un **Codigo de Verificacion**, si el usuario no coloca este c√≥digo, no podr√° acceder a ningun otro endpoint fuera de `/auth/` 
    - `/auth/verify`: El usuario deber√° mandar su **c√≥digo de veificaci√≥n**, si es el correcto ya podr√° acceder a m√°s endpoints, sino podr√° solicitar otro c√≥digo, este vencer√° cada 15 minutos.
    - `/auth/resend` : Sirve para volver a mandarle el **codigo de verificaci√≥n** al usuario.
    - `/auth/login` : Cuando el usuario haya validado su correo, ya podr√° ingresar a su cuenta y tener m√°s accesos.
2. **Funcionalidad de Driver**:
    - Pueden crear rutas, esto con ayuda de ORSapi que les brindar√° un camino que deber√°n seguir desde UTEC hasta su punto de llegada establecido por ellos mismos.
    - Tambi√©n pueden cambiar estado de las solicitudes de los passengers
    - Pueden hacer comentarios sobre los pasajeros que han tenido en una ruta.
    - Su `wallet` se actualiza a medida que recibe pagos de un passenger
3. **Funcionalidad de un Passenger**:
    - Pueden generar solicitudes a rutas ya establecidas de los conductores. Estas solicitudes tienen un tope `capacity` de ruta.
    - Al igual que los drivers, estos puede realizar reviews sobre el viaje que recibieron de un conductor.
      - Realizan pagos a los drivers por un viaje adquirido
4. **Eventos As√≠ncronos:**
    - El backend cuenta con varios eventos que funcionan de manera asincrona, que permiten el envio de correo a nuestros usuarios. Cuando hacen `signup` para el codigo de verificaci√≥n, cuando el driver cambia el estado de una solicitud, o cuando el passenger borra una solicitud.
5. **Manejo de Errores:**
    - Se retornan excepciones descriptivas en cada posible error, como NotFound, NoAuth, Gone, Forbidden, etc..
6. **Testing**
    - Se realiz√≥ testing de todos los controladores de nuestro backend, lo que permiti√≥ saber que estos funcionaban con normalidad.
    - Asimismo, se realiz√≥ testing en Postman para seguir verificando la validez de nuestros endpoints.

### Tecnolog√≠as Implementadas üõ†Ô∏è

- **Open Route Service**: Para la gesti√≥n y creaci√≥n de rutas.
- **Spring Boot 3.3.4**: Desarrollo del backend y gesti√≥n de servicios RESTful.
- **PostgreSQL**: Base de datos relacional principal.
- **H2 Database**: Base de datos en memoria para pruebas.
- **JWT**: Autenticaci√≥n y autorizaci√≥n de usuarios.
- **Hibernate Validator**: Validaci√≥n de datos.
- **Testcontainers**: Pruebas de integraci√≥n con contenedores Docker.
- **Jakarta Mail**: Env√≠o de correos electr√≥nicos.
- **Thymeleaf**: Plantillas HTML para correos electr√≥nicos.
- **Lombok**: Reducci√≥n de c√≥digo repetitivo.
- **OkHttp**: Cliente HTTP eficiente.

## Modelo de Entidades üìä

![Diagrama](src/main/resources/diagrama.png)

| Entidad         | Descripci√≥n                                                                                                                                             | Relaciones                                                                                                                                              |
|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| **User**        | Representa a un individuo registrado en la plataforma Ridemates, que puede ser conductor o pasajero.                                                  | - Un **user** es la clase padre de **driver** y **passenger**.                                                                                       |
| **Passenger**   | Representa a un usuario que busca viajar con conductores, permitiendo solicitar viajes y dejar comentarios.                                            | - Un **passenger** puede realizar muchos **bookings**, pero un **booking** le pertenece solo a un **passenger**.                                      |
| **Driver**      | Ofrece viajes a pasajeros y cuenta con un veh√≠culo y licencia.                                                                                        | - Todos los **drivers** tienen un solo **vehicle**.<br/>- Un conductor puede ofrecer m√°s **routes**, pero una **route** le pertenece a un solo **driver**. |
| **Route**       | Representa el camino que el conductor seguir√°, determinado por ORSapi.                                                                                | - Un **route** es dado por un √∫nico **driver**, permitiendo reservas (**bookings**) de los usuarios.                                                  |
| **Booking**     | Reservas solicitadas por los pasajeros en una ruta existente.                                                                                         | - Un **booking** le pertenece a un **passenger**, pero un **passenger** puede tener de 0 a m√°s **bookings**.<br/>- Un **booking** le pertenece a una sola **route**. |
| **Travel**      | Representa un **booking** confirmado por un **driver**.                                                                                              | - Un **travel** le pertenece a un √∫nico **booking**, y viceversa.                                                                                     |
| **Review**      | Comentarios que los pasajeros pueden dejar sobre su experiencia con los conductores y viceversa.                                                      | - Cada **review** le pertenece a un √∫nico viaje, pero un viaje puede tener de 0 a 2 reviews.                                                           |
| **Payment**     | Representa el pago que el **passenger** har√° por su viaje.                                                                                            | - Cada **payment** le pertenece a un viaje, pero un viaje puede tener de 0 a m√°s **payments**.                                                         |
| **GeoLocation** | Coordenada.                                                                                                                                           | -                                                                                                                                                       |
| **Vehicle**     | Informaci√≥n del veh√≠culo de un conductor.                                                                                                            | - Todos los **vehicles** le pertenecen a un **driver**, y cada **driver** tiene un **vehicle**.                                                        |

## Testing y Manejo de Errores üß™üö®

### Testing üß™

El proyecto incluye un enfoque exhaustivo de pruebas para asegurar la calidad y funcionalidad:

- **Pruebas Unitarias**: Verifican la l√≥gica de clases y m√©todos individuales.
- **Pruebas de Integraci√≥n**: Eval√∫an la interacci√≥n entre componentes del sistema, utilizando **Testcontainers** para un entorno de pruebas aislado. Se utiliz√≥ testcontainers para probar la persistencia de datos, especialmente en el caso de **Booking** 
- **Pruebas Funcionales**: Aseguran que las caracter√≠sticas cumplan con los requisitos del usuario. Probamos todos los controladores de nuestras entidades, con todos lo endpoints, de esta manera nos aseguramos de que funcionen como se espera y retornando os httpresponse adecuados
- **Pruebas de Seguridad**: Verifican la implementaci√≥n de **JWT** y la protecci√≥n de endpoints. Se utiliz√≥ @WithMockUser con el fin de saber que endpoints son accesibles a ciertos usuarios con ciertos roles.

### Manejo de Errores üö®

Se implementan estrategias efectivas para el manejo de errores, garantizando una experiencia de usuario fluida:

- **Validaci√≥n de Entradas**: Uso de **Hibernate Validator** para asegurar datos v√°lidos.
- **Manejo Centralizado de Errores**: Controlador de excepciones global para respuestas claras y coherentes.
- **Respuestas HTTP**: Se devuelven c√≥digos de error significativos:
   - **403: Forbidden**: Acceso denegado a recursos.
   - **410: Gone**: Recursos ya no disponibles.
   - **401: NoAuth**: Autenticaci√≥n requerida.
   - **404: NotFound**: Recursos no encontrados.
   - **409: Conflict**: Conflictos con el estado actual del recurso.

## Medidas de Seguridad Implementadas üîí

Implementamos varias medidas de seguridad para proteger los datos y la autenticaci√≥n de usuarios:

1. **Controlador de Autenticaci√≥n** üîê:
   - Rutas para registro, inicio de sesi√≥n, verificaci√≥n y reenv√≠o de c√≥digos.
2. **Servicio de Autenticaci√≥n** üõ°Ô∏è:
   - Generaci√≥n y verificaci√≥n de c√≥digos de verificaci√≥n √∫nicos con expiraci√≥n.
3. **Configuraci√≥n de Seguridad** ‚öôÔ∏è:
   - Filtrado de solicitudes y gesti√≥n de sesiones sin estado (`STATLESS`).
   - Configuraci√≥n de **CORS** para permitir acceso desde dominios espec√≠ficos.
4. **Manejo de Errores** üö®:
   - Respuestas espec√≠ficas para errores comunes, garantizando claridad y seguridad en la comunicaci√≥n.

## Eventos y Asincron√≠a üì©‚ö°

La gesti√≥n de eventos en "Ride-Mates" se implementa utilizando un enfoque basado en eventos as√≠ncronos, lo cual permite realizar tareas en segundo plano sin bloquear la ejecuci√≥n principal. Estas son algunas de las caracter√≠sticas principales de los eventos implementados:

1. **Definici√≥n de Eventos** üìù:
   - Se crean clases espec√≠ficas para representar los eventos, como `ValidateEvent`, `DeleteBookingEvent`, y `StatusBookingEvent`.
   - Los eventos contienen informaci√≥n relevante para la acci√≥n que desencadenan, como detalles del usuario registrado o datos de la reserva.
2. **Manejadores de Eventos** üéß:
   - Los manejadores escuchan estos eventos y ejecutan acciones espec√≠ficas en respuesta, como el env√≠o de correos electr√≥nicos o actualizaciones en la base de datos.
   - Cada evento tiene un manejador dedicado que procesa la l√≥gica relacionada de manera eficiente.
3. **Ejemplos de Eventos Utilizados** üõéÔ∏è:
   - **`ValidateEvent`**: Se dispara cuando un usuario se registra y necesita verificar su correo electr√≥nico.
   - **`DeleteBookingEvent`**: Se activa al cancelar una reserva, notificando al pasajero correspondiente.
   - **`StatusBookingEvent`**: Se genera cuando hay un cambio en el estado de una reserva.
4. **Asincron√≠a con `@Async`** ‚ö°:
   - Para mejorar la eficiencia, algunas tareas, como el env√≠o de correos electr√≥nicos, se ejecutan de manera **as√≠ncrona** utilizando la anotaci√≥n `@Async`.
   - Esto reduce el tiempo de espera para el usuario y optimiza el rendimiento del sistema.
5. **Servicio de Correo As√≠ncrono** üìß:
   - El **`EmailService`** se encarga de construir y enviar correos electr√≥nicos utilizando plantillas HTML personalizadas.
   - Esto incluye correos de confirmaci√≥n, actualizaciones de estado y notificaciones de pagos.

Estas pr√°cticas nos permiten mantener la aplicaci√≥n √°gil y responsive, mejorando la comunicaci√≥n con nuestros usuarios sin afectar el rendimiento general del sistema.

## GitHub üìÇ

[Repositorio del Proyecto](https://github.com/tu-repositorio)

## Conclusi√≥n üéâ

"Ride-Mates" es una soluci√≥n que aborda la inseguridad en el transporte de estudiantes en la UTEC. Hemos desarrollado una plataforma intuitiva y segura que no solo facilita el transporte, sino que tambi√©n promueve la colaboraci√≥n y el sentido de comunidad entre los estudiantes. A medida que avanzamos, consideramos agregar nuevas funcionalidades que enriquecer√°n a√∫n m√°s la experiencia de los usuarios y mejorar√°n la seguridad.

## Ap√©ndice üìö

### Posibles Funcionalidades Futuras üöÄ
- **Sistema de autenticaci√≥n con correo estudiantil (oAuth)** üìß.
- **B√∫squeda de la mejor ruta de un punto a otro (Distance Matrix API)** üìç.
- **Chat en tiempo real (WebSockets)** üí¨.
- **Seguimiento de ubicaci√≥n en tiempo real (Live Tracking)** üì°.
- **Pasarela de Pagos** üí≥.

### Requisitos üìã
Estamos utilizando para la compilaci√≥n:
- **Java 21** ‚òï
- **Maven** üõ†Ô∏è

---
